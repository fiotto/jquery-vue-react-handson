<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <link rel="stylesheet" type="text/css" href="css/style.css">

  <script crossorigin src="https://code.jquery.com/jquery-3.4.1.js"></script>

  <title>jQueryのサンプル</title>
</head>
<body>
  <div class="container">
    <h1><span id="text-title">___</span>のサンプル</h1>

    <div class="row">
      <input type="text" class="form-control" id="input-item"/>
      <button type="button" class="btn-action" id="button-add">追加</button>
    </div>

    <div class="tmp-space">
      入力値 : <span id="text-item">___</span>
    </div>

    <div>
      <table class="table-bordered">
        <thead>
          <tr>
            <th>重要度大</th>
            <th>重要度中</th>
            <th>重要度小</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="area-todo-high">
            </td>
            <td id="area-todo-normal">
            </td>
            <td id="area-todo-low">
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="tmp-space">
      重要度の変更を表示 : <span id="text-is-selectd-item">___</span>
    </div>

    <div id="area-is-selectd-item">
      <div class="content-center">
        <div class="card">
          <p class="text-center">
            <span class="color-red" id="text-selected-item">___</span>の重要度を
          </p>
          <p>
            <button type="button" class="btn-action button-priority"
              id="button-priority-up"
            >上げる</button>
            <button type="button" class="btn-action button-priority"
              id="button-priority-down"
            >下げる</button>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // TODO ここに記述する
    // STEP 2
    const title = 'jQuery';

    $('#text-title').text(title);

    // STEP 3

    // STEP 4
    const todos = {
      high : ['掃除', '洗濯', '炊事'],
      normal: ['買い物', '草刈り', 'アイロン'],
      low: ['窓拭き', '振り込み', '家計簿管理']
    };

    $('#area-todo-high').empty();
    for(todo of todos.high){
      $('#area-todo-high').append(
        $('<p></p>').append(
          $('<button></button>', {
            'type': 'button',
            'class': 'btn-todo btn-todo-high'
          }).append(todo)
        )
      );
    }

    $('#area-todo-normal').empty();
    for(todo of todos.normal){
      $('#area-todo-normal').append(
        $('<p></p>').append(
          $('<button></button>', {
            'type': 'button',
            'class': 'btn-todo btn-todo-normal'
          }).append(todo)
        )
      );
    }

    $('#area-todo-low').empty();
    for(todo of todos.low){
      $('#area-todo-low').append(
        $('<p></p>').append(
          $('<button></button>', {
            'type': 'button',
            'class': 'btn-todo btn-todo-low'
          }).append(todo)
        )
      );
    }

    // STEP 5
    $('#input-item').on('input', function(){
      $('#text-item').text($(this).val());
    }).trigger('input');

    // STEP 6
    $('#input-item').on('input', function(){
      $('#text-item').text($(this).val());
    }).trigger('input');

    $('#button-add').on('click', function(){
      const inputItem = $('#input-item').val();

      $('#area-todo-normal').append(
        $('<p></p>').append(
          $('<button></button>', {
            'type': 'button',
            'class': 'btn-todo btn-todo-normal'
          }).append(inputItem)
        )
      );

      $('#input-item').val('');
      $('#input-item').trigger('input');
    });

    // STEP 7
    $('#area-is-selectd-item').hide();
    $('#text-is-selectd-item').text(String(false));

    $(document).on('click', '.btn-todo', function(){
      const selecedItem = $(this).text();

      $('.btn-todo').removeClass('selected');
      $(this).addClass('selected');

      $('#area-is-selectd-item').show();
      $('#text-is-selectd-item').text(String(true));
      $('#text-selected-item').text(selecedItem);

      // STEP 8
      $('#button-priority-up').prop('disabled', 
          $(`.btn-todo-high:contains("${selecedItem}")`).length > 0);

      $('#button-priority-down').prop('disabled', 
        $(`.btn-todo-low:contains("${selecedItem}")`).length > 0);
    });

    // STEP 8
    $('.button-priority').on('click', function(){
      const selecedItem = $('.btn-todo.selected').text();

      const signum = $(this).attr('id') === 'button-priority-up' ? 1 : -1;

      const keys = Object.keys(todos);
      for(let idx in keys){
        const key = keys[idx];

        const $elm = $(`.btn-todo-${key}:contains("${selecedItem}")`);
        if($elm.length > 0){
          $elm.parents('p').remove();

          const destIndex = (signum > 0) ? Number(idx)-1 : Number(idx)+1;
          const dest = keys[destIndex];

          $(`#area-todo-${dest}`).append(
            $('<p></p>').append(
              $('<button></button>', {
                'type': 'button',
                'class': `btn-todo btn-todo-${dest}`
              }).append(selecedItem)
            )
          );

          $('#area-is-selectd-item').hide();
          $('#text-is-selectd-item').text(String(false));

          break;
        }
      }
    })
  </script>
</body>
</html>
