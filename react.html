<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <link rel="stylesheet" type="text/css" href="css/style.css">

  <script crossorigin src="https://unpkg.com/react@16.8.6/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>

  <title>Reactのサンプル</title>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // TODO ここに記述する
    const title = 'React';

    function Priority(props){
      function isSelectdItem(){
        return props.selectedItem !== null;
      }

      function onClickPriority(signum){
        props.onClickPriority(signum)
      }

      if(isSelectdItem()){
        return (
          <div>
            <div className="content-center">
              <div className="card">
                <p className="text-center">
                  <span className="color-red">{ props.selectedItem }</span>の重要度を
                </p>
                <p>
                  <button type="button" className="btn-action"
                    disabled={ props.selectedPriority === 'high' }
                    onClick={ () => onClickPriority(1) }
                  >上げる</button>
                  <button type="button" className="btn-action"
                    disabled={ props.selectedPriority === 'low' }
                    onClick={ () => onClickPriority(-1) }
                  >下げる</button>
                </p>
              </div>
            </div>
          </div>
        );
      }else{
        return null;
      }
    }

    function App(){
      const [todos, setTodos] = React.useState({
        high : [],
        normal: [],
        low: []
      });
      const [inputItem, setInputItem] = React.useState('');
      const [selectedItem, setSelectedItem] = React.useState(null);

      function addItem(){
        todos.normal.push(inputItem);
        setTodos({...todos});
        setInputItem('');
      }

      function onClickTodo(todo){
        setSelectedItem(todo);
      }

      function selectedPriority(){
        const keys = Object.keys(todos);
        const selectedPriority = keys.filter((a) => todos[a].includes(selectedItem));

        return selectedPriority[0];
      }

      function onClickPriority(signum){
        const keys = Object.keys(todos);

        for(let idx in keys){
          const key = keys[idx];

          if(todos[key].includes(selectedItem)){
            todos[key] = todos[key].filter((a) => a !== selectedItem);

            const destIndex = (signum > 0) ? Number(idx)-1 : Number(idx)+1;
            const dest = keys[destIndex];
            todos[dest].push(selectedItem);

            setSelectedItem(null);
            break;
          }
        }

        setTodos({...todos});
      }

      return (
        <div className="container">
          <h1><span>{ title }</span>のサンプル</h1>

          <div className="row">
            <input type="text" className="form-control" 
              value={ inputItem }
              onChange={ (e) => setInputItem(e.target.value) }
            />
            <button type="button" className="btn-action" onClick={ addItem }>追加</button>
          </div>

          <div>
            <table className="table-bordered">
              <thead>
                <tr>
                  <th>重要度大</th>
                  <th>重要度中</th>
                  <th>重要度小</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    { todos.high.map((todo) => (
                      <p key={ todo }>
                        <button type="button"
                          className={ "btn-todo-high " + ( todo === selectedItem ? 'selected' : '' ) }
                          onClick={ () => onClickTodo(todo) }
                        >{ todo }</button>
                      </p>
                    )) }
                  </td>
                  <td>
                    { todos.normal.map((todo) => (
                      <p key={ todo }>
                        <button type="button"
                          className={ "btn-todo-normal " + ( todo === selectedItem ? 'selected' : '' ) }
                          onClick={ () => onClickTodo(todo) }
                        >{ todo }</button>
                      </p>
                    )) }
                  </td>
                  <td>
                    { todos.low.map((todo) => (
                      <p key={ todo }>
                        <button type="button"
                          className={ "btn-todo-low " + ( todo === selectedItem ? 'selected' : '' ) }
                          onClick={ () => onClickTodo(todo) }
                        >{ todo }</button>
                      </p>
                    ))}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <Priority
            selectedItem={ selectedItem }
            selectedPriority={ selectedPriority() }
            onClickPriority={ onClickPriority }
          ></Priority>
        </div>
      );
    }
    
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
